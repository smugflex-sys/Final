import{u as R,r as i,j as e,A as E,C as L,a as k,L as l,I as c,S as g,b as u,c as p,d as j,e as o,B as _,f as O,g as q,t as x}from"./index-BKslQ2tN.js";function $({onClose:B,onSuccess:v}){const{classes:b,parents:S,addStudent:w,currentAcademicYear:y}=R(),[N,f]=i.useState(!1),[d,m]=i.useState(null),A=i.useRef(null),[a,r]=i.useState({first_name:"",last_name:"",date_of_birth:"",gender:void 0,class_id:"",parent_id:"",photo_url:""}),[t,h]=i.useState({}),C=()=>{const s={};return a.first_name.trim()||(s.first_name="First name is required"),a.last_name.trim()||(s.last_name="Last name is required"),a.date_of_birth||(s.date_of_birth="Date of birth is required"),a.gender||(s.gender="Gender is required"),a.class_id||(s.class_id="Class is required"),h(s),Object.keys(s).length===0},F=()=>{if(!d){x.error("Please select a photo");return}const s=new FileReader;s.onloadend=()=>{const n=s.result;r({...a,photo_url:n}),x.success("Photo uploaded successfully")},s.readAsDataURL(d)},P=s=>{if(s.preventDefault(),!C()){x.error("Please fill all required fields");return}const n=b.find(I=>I.id===parseInt(a.class_id));if(!n){x.error("Invalid class selected");return}f(!0),w({first_name:a.first_name,last_name:a.last_name,admission_number:"",class_id:parseInt(a.class_id),class_name:n.name,level:n.level,parent_id:a.parent_id&&a.parent_id!=="none"?parseInt(a.parent_id):null,date_of_birth:a.date_of_birth,gender:a.gender||"Male",photo_url:a.photo_url||void 0,passport_photo:a.photo_url||void 0,status:"Active",academic_year:y,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),x.success("Student registered successfully!"),r({first_name:"",last_name:"",date_of_birth:"",gender:void 0,class_id:"",parent_id:"",photo_url:""}),m(null),h({}),v(),f(!1)},D=()=>{r({first_name:"",last_name:"",date_of_birth:"",gender:void 0,class_id:"",parent_id:"",photo_url:""}),m(null),h({})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"bg-blue-50 border-blue-200 rounded-xl",children:[e.jsx(L,{className:"h-4 w-4 text-blue-600"}),e.jsxs(k,{className:"text-gray-900",children:[e.jsx("strong",{children:"Student Registration Process:"}),e.jsx("br",{}),"1. Enter student personal information",e.jsx("br",{}),"2. Assign to a class (determines fee structure)",e.jsx("br",{}),"3. Optionally link to existing parent",e.jsx("br",{}),"4. Optionally upload passport photo for result cards",e.jsx("br",{}),"5. Admission number will be auto-generated"]})]}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md text-gray-900 font-medium",children:"Personal Details"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"text-gray-700",children:["First Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{placeholder:"Enter first name",value:a.first_name,onChange:s=>r({...a,first_name:s.target.value}),className:`h-12 rounded-xl border ${t.first_name?"border-red-500":"border-gray-300"} bg-white text-gray-900`}),t.first_name&&e.jsx("p",{className:"text-xs text-red-500",children:t.first_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"text-gray-700",children:["Last Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{placeholder:"Enter last name",value:a.last_name,onChange:s=>r({...a,last_name:s.target.value}),className:`h-12 rounded-xl border ${t.last_name?"border-red-500":"border-gray-300"} bg-white text-gray-900`}),t.last_name&&e.jsx("p",{className:"text-xs text-red-500",children:t.last_name})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"text-gray-700",children:["Date of Birth ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{type:"date",value:a.date_of_birth,onChange:s=>r({...a,date_of_birth:s.target.value}),className:`h-12 rounded-xl border ${t.date_of_birth?"border-red-500":"border-gray-300"} bg-white text-gray-900`}),t.date_of_birth&&e.jsx("p",{className:"text-xs text-red-500",children:t.date_of_birth})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"text-gray-700",children:["Gender ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(g,{value:a.gender,onValueChange:s=>r({...a,gender:s}),children:[e.jsx(u,{className:`h-12 rounded-xl border ${t.gender?"border-red-500":"border-gray-300"} bg-white text-gray-900`,children:e.jsx(p,{placeholder:"Select gender"})}),e.jsxs(j,{className:"bg-white border-gray-200",children:[e.jsx(o,{value:"Male",className:"text-gray-900",children:"Male"}),e.jsx(o,{value:"Female",className:"text-gray-900",children:"Female"})]})]}),t.gender&&e.jsx("p",{className:"text-xs text-red-500",children:t.gender})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-md text-gray-900 font-medium",children:"Academic Details"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"text-gray-700",children:["Assign to Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(g,{value:a.class_id,onValueChange:s=>r({...a,class_id:s}),children:[e.jsx(u,{className:`h-12 rounded-xl border ${t.class_id?"border-red-500":"border-gray-300"} bg-white text-gray-900`,children:e.jsx(p,{placeholder:"Select class"})}),e.jsx(j,{className:"bg-white border-gray-200",children:b.filter(s=>s.status==="Active").map(s=>e.jsxs(o,{value:s.id.toString(),className:"text-gray-900",children:[s.name," - ",s.level," (",s.current_students,"/",s.capacity," students)"]},s.id))})]}),t.class_id&&e.jsx("p",{className:"text-xs text-red-500",children:t.class_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-gray-700",children:"Academic Year"}),e.jsx(c,{value:y,disabled:!0,className:"h-12 rounded-xl border border-gray-300 bg-gray-100 text-gray-900"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-md text-gray-900 font-medium",children:"Parent/Guardian Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-gray-700",children:"Link to Existing Parent (Optional)"}),e.jsxs(g,{value:a.parent_id,onValueChange:s=>r({...a,parent_id:s}),children:[e.jsx(u,{className:"h-12 rounded-xl border border-gray-300 bg-white text-gray-900",children:e.jsx(p,{placeholder:"Select parent (optional)"})}),e.jsxs(j,{className:"bg-white border-gray-200",children:[e.jsx(o,{value:"none",className:"text-gray-900",children:"No parent linked"}),S.filter(s=>s.status==="Active").map(s=>e.jsxs(o,{value:s.id.toString(),className:"text-gray-900",children:[s.first_name," ",s.last_name," - ",s.phone]},s.id))]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:'You can link parent now or later from "Link Student-Parent" page'})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-md text-gray-900 font-medium",children:"Student Photo (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-gray-700",children:"Upload Passport Photo"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{ref:A,type:"file",accept:"image/*",onChange:s=>m(s.target.files?.[0]||null),className:"rounded-xl border-gray-300 bg-white text-gray-900"}),e.jsxs(_,{type:"button",onClick:F,disabled:!d,className:"bg-[#06B6D4] hover:bg-[#0891B2] text-white rounded-xl",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Upload"]})]}),d&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected: ",d.name]}),a.photo_url&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:a.photo_url,alt:"Student passport",className:"w-16 h-16 rounded-lg object-cover border border-gray-300"}),e.jsx("p",{className:"text-sm text-green-600",children:"âœ“ Photo uploaded successfully"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload student passport photo for result cards and identification"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(_,{type:"button",onClick:D,variant:"outline",className:"rounded-xl border-gray-300 text-gray-700 hover:bg-gray-50",children:"Reset Form"}),e.jsxs(_,{type:"submit",disabled:N,className:"bg-[#10B981] hover:bg-[#059669] text-white rounded-xl shadow-sm",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),N?"Registering...":"Register Student"]})]})]})]})}export{$ as default};
